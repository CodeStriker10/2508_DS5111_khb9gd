{{ config(
    materialized='table'
) }}

SELECT 
    symbol,
    COUNT(*) as record_count
FROM (
    -- WSJ Tables (extract symbol from parentheses in INDEX_1)
    SELECT REGEXP_SUBSTR(INDEX_1, '\\(([A-Z]+)\\)', 1, 1, 'e', 1) AS symbol 
    FROM DS2508.KHB9GD.WSJGAINERS_20251112_093123
    UNION ALL
    SELECT REGEXP_SUBSTR(INDEX_1, '\\(([A-Z]+)\\)', 1, 1, 'e', 1) AS symbol 
    FROM DS2508.KHB9GD.WSJGAINERS_20251113_160129
    UNION ALL
    SELECT REGEXP_SUBSTR(INDEX_1, '\\(([A-Z]+)\\)', 1, 1, 'e', 1) AS symbol 
    FROM DS2508.KHB9GD.WSJGAINERS_20251114_093130
    UNION ALL
    -- Yahoo Tables
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251112_123020
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251112_160116
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251113_093119
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251113_123022
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251113_160129
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251114_093130
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251114_123014
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251114_160117
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251117_093125
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251117_123025
    UNION ALL
    SELECT SYMBOL FROM DS2508.KHB9GD.YGAINERS_20251117_160119
)
WHERE symbol IS NOT NULL
GROUP BY symbol
ORDER BY record_count DESC, symbol
